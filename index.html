<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° ASCENSION PROTOCOL - EXECUTION MODE</title>
    <style>
        :root {
            --bg-color: #f7f9fc; 
            --card-bg: #ffffff;
            --primary: #007bff; /* Focus Blue */
            --accent: #ff7043; /* Action Orange */
            --text: #333333;
            --dim: #6c757d;
            --font-main: 'Roboto', sans-serif;
        }

        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;700;900&display=swap');

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text);
            font-family: var(--font-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- Overlay (Initial State) --- */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98);
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; z-index: 1000; cursor: pointer;
        }
        #overlay h1 { font-size: 2.5rem; color: var(--primary); margin-bottom: 30px; }
        #overlay button {
            padding: 15px 40px; font-size: 1.2rem; font-weight: 700;
            color: white; background-color: var(--accent); border: none;
            border-radius: 50px; cursor: pointer; transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);
        }
        #overlay button:hover { background-color: #ff5722; transform: translateY(-2px); }

        /* --- Main Content Layout --- */
        .container {
            display: flex;
            max-width: 1200px;
            margin: 20px auto;
            width: 95%;
            gap: 20px;
        }

        /* --- Left Panel (Timer, Task, Quote, New Counters) --- */
        .left-panel {
            flex: 3;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .dashboard-head {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .protocol-title {
            font-size: 1.4rem; font-weight: 900;
            color: var(--primary); letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .current-task-main {
            font-size: 2.5rem; font-weight: 900;
            color: var(--text); margin: 10px 0;
            text-transform: uppercase;
        }

        .countdown {
            font-size: 6rem; font-weight: 100;
            color: var(--accent); line-height: 1;
        }

        .sub-task-timer {
            margin-top: 15px; padding: 10px;
            background-color: #f0f0f0; border-radius: 8px;
            font-size: 1.2rem; font-weight: 700;
            color: var(--primary);
        }

        .sub-info {
            margin-top: 10px; color: var(--dim);
            font-size: 0.9rem; font-weight: 500;
        }

        /* --- Motivation Section --- */
        .motivation-box {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--accent);
        }
        .motivation-box h3 {
            color: var(--accent); font-size: 1rem;
            margin-bottom: 10px; text-transform: uppercase;
        }
        #motivationQuote {
            font-style: italic; font-size: 1.1rem;
            font-weight: 400; color: var(--text);
            line-height: 1.4;
        }
        
        /* --- NEW COUNTERS WIDGET --- */
        .counter-widget {
            background: linear-gradient(135deg, #e0f7fa, #b3e5fc);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .counter-widget h3 {
            color: var(--primary);
            font-size: 1.4rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            font-weight: 900;
        }
        .counter-grid {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
        }
        .counter-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .counter-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--accent);
            line-height: 1;
        }
        .counter-label {
            font-size: 0.8rem;
            color: var(--dim);
            text-transform: uppercase;
            margin-top: 5px;
        }
        .counter-message {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text);
            padding: 10px;
            background-color: #fff;
            border-radius: 6px;
            border: 2px solid var(--accent);
        }


        /* --- Right Panel (Schedule & Music) --- */
        .right-panel {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* --- Music Player Section (Side Panel) */
        .music-player {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .music-player h3 {
            color: var(--primary); margin-bottom: 10px; font-size: 1.2rem;
        }
        #fileInput { display: none; }
        .file-label {
            display: block; background-color: var(--primary);
            color: white; padding: 10px 15px; border-radius: 8px;
            cursor: pointer; text-align: center; font-weight: bold;
            transition: background-color 0.3s;
        }
        .file-label:hover { background-color: #0056b3; }
        audio {
            width: 100%; margin-top: 15px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        #trackName {
            font-size: 0.85rem; color: var(--dim); margin-top: 5px; text-align: center;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* --- Schedule List --- */
        .schedule-box {
            background-color: var(--card-bg);
            padding: 20px 0 0 0;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            flex: 1; 
            min-height: 300px;
        }
        .schedule-box h3 {
            color: var(--text); font-size: 1.2rem; margin: 0 20px 10px;
            border-bottom: 1px solid #eee; padding-bottom: 10px;
        }

        /* Set a fixed height for the scroll container */
        .schedule-list {
            padding: 0 20px;
            overflow-y: auto;
            max-height: 80vh; 
        }

        .schedule-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            color: var(--dim);
            transition: all 0.2s;
        }

        /* Style for completed tasks */
        .schedule-item.completed {
            opacity: 0.4;
            font-style: italic;
            border-left: 3px solid #ccc;
        }

        .schedule-item.active {
            background-color: rgba(0, 123, 255, 0.05);
            color: var(--primary);
            font-weight: 700;
            border-radius: 4px;
            padding: 12px 5px;
            margin: 0 -5px;
            opacity: 1; /* Ensure active item is fully opaque */
        }

        .time-col { font-weight: 600; min-width: 100px; }
        .task-col { flex: 1; text-align: left; text-transform: uppercase; margin-left: 10px; font-size: 0.95rem;}

        /* --- Footer --- */
        .footer {
            padding: 15px; text-align: center; font-size: 0.9rem;
            color: var(--dim); border-top: 1px solid #e0e0e0;
            margin-top: 20px;
        }

        /* Mobile adjustments */
        @media (max-width: 900px) {
            .container { flex-direction: column; }
            .right-panel, .left-panel { flex: none; width: 100%; }
            .dashboard-head { padding: 20px; }
            .countdown { font-size: 5rem; }
            .current-task-main { font-size: 1.8rem; }
            .schedule-list { max-height: 40vh; }
        }
    </style>
</head>
<body>

    <audio id="alarmSound" preload="auto"></audio>

    <div id="overlay">
        <h1>ü¶Å ASCENSION PROTOCOL</h1>
        <button onclick="startProtocol()">INITIATE PROTOCOL</button>
    </div>

    <div class="container">
        <div class="left-panel">
            <div class="dashboard-head">
                <div class="protocol-title">EXECUTION MODE | CURRENT PHASE</div>
                <div class="countdown" id="timer">00:00:00</div>
                <div class="current-task-main" id="taskName">LOADING...</div>
                
                <div class="sub-task-timer" id="subTaskTimer">
                    <span>Task Detail:</span> <span id="subTaskName">Awaiting Cycle Start</span>
                </div>
                
                <div class="sub-info" id="nextTask">Up Next: ...</div>
            </div>

            <div class="counter-widget">
                <h3>NEET TARGET LOCK</h3>
                <div class="counter-grid">
                    <div class="counter-item">
                        <div class="counter-value" id="daysCount">000</div>
                        <div class="counter-label">Days</div>
                    </div>
                    <div class="counter-item">
                        <div class="counter-value" id="hoursCount">00</div>
                        <div class="counter-label">Hours</div>
                    </div>
                    <div class="counter-item">
                        <div class="counter-value" id="minutesCount">00</div>
                        <div class="counter-label">Minutes</div>
                    </div>
                </div>
                <div class="counter-message">
                    Execute this plan for **90 Days**, then let the rest of your life settle.
                </div>
            </div>
            
            <div class="motivation-box">
                <h3>Mindset Hardening</h3>
                <blockquote id="motivationQuote">"Your transformation begins when you stop negotiating with yourself."</blockquote>
            </div>

        </div>

        <div class="right-panel">
            <div class="music-player">
                <h3>üéß Focused Soundscape</h3>
                <label for="fileInput" class="file-label">Load Study Tracks</label>
                <input type="file" id="fileInput" multiple accept="audio/*">
                <audio id="musicPlayer" controls loop></audio>
                <div id="trackName">No track loaded.</div>
            </div>

            <div class="schedule-box">
                <h3>Protocol Timetable</h3>
                <div class="schedule-list" id="scheduleList">
                    </div>
            </div>
        </div>
    </div>

    <div class="footer">
        "Your batchmates will study. You will dominate."
    </div>

    <script>
        // --- Configuration ---
        const schedule = [
            { start: "08:00", end: "08:30", task: "üåÖ WAKE UP (Hydrate & Prep)", type: "prep", breakdown: [] },
            { start: "08:30", end: "10:00", task: "‚öîÔ∏è CYCLE 1", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "10:00", end: "10:15", task: "‚òï BREAK (Water/Stretch)", type: "break", breakdown: [] },
            { start: "10:15", end: "11:45", task: "‚öîÔ∏è CYCLE 2", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "11:45", end: "12:00", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "12:00", end: "12:45", task: "üçΩÔ∏è LUNCH + RESET", type: "break", breakdown: [] },
            { start: "12:45", end: "14:15", task: "‚öîÔ∏è CYCLE 3", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "14:15", end: "14:30", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "14:30", end: "16:00", task: "‚öîÔ∏è CYCLE 4", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "16:00", end: "16:15", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "16:15", end: "17:45", task: "‚öîÔ∏è CYCLE 5", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "17:45", end: "18:30", task: "üí™ BODY RESET (Workout)", type: "prep", breakdown: [] },
            { start: "18:30", end: "19:00", task: "üçΩÔ∏è DINNER (No Screen Zone)", type: "break", breakdown: [] },
            { start: "19:00", end: "20:30", task: "‚öîÔ∏è CYCLE 6", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "20:30", end: "20:45", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "20:45", end: "22:15", task: "‚öîÔ∏è CYCLE 7", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "22:15", end: "22:30", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "22:30", end: "23:59", task: "üß® CYCLE 8 (THE KILLER)", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] }, 
            { start: "00:00", end: "00:20", task: "üìñ WIND DOWN (Skim & Reset)", type: "prep", breakdown: [] },
            { start: "00:20", end: "08:00", task: "üò¥ SLEEP & RECOVER", type: "sleep", breakdown: [] }
        ];
        
        // Target Exam Date (Adjust this date for your actual exam)
        const NEET_TARGET_DATE = new Date('May 4, 2026 14:00:00'); 

        const quotes = [
            "Every distraction is a sniper bullet to your rank. Stay locked.",
            "Identity hardens when focus becomes default. You are ascending.",
            "While the world sleeps, you sharpen your edge. Dominate this cycle.",
            "Physics will start clicking. Biology will become reflex. Trust the process.",
            "Your past will scratch you. Your future will pull you. Keep moving.",
            "The brain never overfills. This is execution mode, not timepass studying.",
            "Your confidence will harden. Panic will reduce. Vision will sharpen.",
            "Success is the sum of small efforts, repeated day in and day out.",
            "My day is locked. My destiny is loading. Let's execute."
        ];

        // --- Global Variables & Audio Context ---
        let protocolStarted = false;
        let lastSeconds = -1;
        let lastCycleIndex = -1;
        let lastSubTaskIndex = -1;
        let currentSubTaskEnd = null;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        const musicPlayer = document.getElementById('musicPlayer');
        const fileInput = document.getElementById('fileInput');
        const trackNameEl = document.getElementById('trackName');
        const scheduleListEl = document.getElementById('scheduleList');
        
        let playlist = [];
        let currentTrackIndex = 0;

        // --- Music Player Logic ---
        function handleFileSelection(event) {
            playlist = Array.from(event.target.files);
            currentTrackIndex = 0;
            if (playlist.length > 0) {
                loadAndPlayTrack();
            } else {
                trackNameEl.textContent = 'No track loaded.';
            }
        }

        function loadAndPlayTrack() {
            if (playlist.length === 0) return;
            const file = playlist[currentTrackIndex];
            const objectURL = URL.createObjectURL(file);
            
            musicPlayer.src = objectURL;
            
            trackNameEl.textContent = `Playing: ${file.name}`;
            
            musicPlayer.play().catch(e => console.error("Autoplay prevented:", e));
        }

        musicPlayer.addEventListener('ended', () => {
            currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
            loadAndPlayTrack();
        });

        fileInput.addEventListener('change', handleFileSelection);

        // --- Alarm Logic ---
        function playAlarm() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(600, audioCtx.currentTime); 
            
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.5);
        }

        // --- Quote Update Logic ---
        function updateQuote() {
            const index = Math.floor(Math.random() * quotes.length);
            document.getElementById('motivationQuote').innerText = quotes[index];
        }

        // --- NEET Counter Logic ---
        function updateNeetCounter() {
            const now = new Date().getTime();
            const distance = NEET_TARGET_DATE.getTime() - now;

            if (distance < 0) {
                document.getElementById('daysCount').innerText = "000";
                document.getElementById('hoursCount').innerText = "00";
                document.getElementById('minutesCount').innerText = "00";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            
            document.getElementById('daysCount').innerText = String(days).padStart(3, '0');
            document.getElementById('hoursCount').innerText = String(hours).padStart(2, '0');
            document.getElementById('minutesCount').innerText = String(minutes).padStart(2, '0');
        }

        // --- Helper function to create a schedule item HTML ---
        function createScheduleItemHTML(item, index, status) {
            const div = document.createElement('div');
            let classes = 'schedule-item';
            if (status === 'active') classes += ' active';
            if (status === 'completed') classes += ' completed';

            div.className = classes;
            div.id = `item-${index}`;
            
            let taskDetails = item.task;
            if (item.type === 'work' && item.breakdown.length > 0) {
                 taskDetails += ' (' + item.breakdown.map(b => b.split(' ')[0] + ' ' + b.split(' ')[1]).join('/') + ')';
            }

            div.innerHTML = `
                <div class="time-col">${item.start} - ${item.end}</div>
                <div class="task-col">${taskDetails}</div>
            `;
            return div;
        }

        // --- Re-render Schedule List Logic (THE FIX) ---
        function reorderScheduleList(currentTaskIndex) {
            scheduleListEl.innerHTML = '';
            
            const listFragment = document.createDocumentFragment();
            const completedItems = [];

            // 1. Add current and future tasks
            for (let i = currentTaskIndex; i < schedule.length; i++) {
                const status = (i === currentTaskIndex) ? 'active' : 'future';
                listFragment.appendChild(createScheduleItemHTML(schedule[i], i, status));
            }

            // 2. Collect tasks completed today (i.e., before the current task)
            for (let i = 0; i < currentTaskIndex; i++) {
                completedItems.push(createScheduleItemHTML(schedule[i], i, 'completed'));
            }

            // 3. Append completed tasks to the bottom of the list
            completedItems.forEach(item => listFragment.appendChild(item));
            
            scheduleListEl.appendChild(listFragment);

            // Since the list is re-rendered with the active task at the top, 
            // we no longer need scrollIntoView. The 'active' item is the first child.
            // The list acts like a true roller.
        }
        
        // --- Dummy function for initial render (optional now, but kept for structure) ---
        function renderSchedule() {
            // Initial render is now handled entirely within updateTimer/reorderScheduleList
            // We ensure updateTimer is called immediately after startProtocol.
        }

        function getTodayDate(timeStr) {
            const now = new Date();
            const [hours, minutes] = timeStr.split(':').map(Number);
            const date = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, 0);
            return date;
        }

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = totalSeconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }
        
        function updateSubTask(now, currentItem, currentItemStart) {
            const subTaskEl = document.getElementById('subTaskName');
            const breakdown = currentItem.breakdown;
            
            if (!breakdown || breakdown.length === 0) {
                subTaskEl.innerText = currentItem.type === 'work' ? "Focused Work Period" : "Scheduled Rest/Prep";
                currentSubTaskEnd = null; 
                lastSubTaskIndex = -1;
                return;
            }

            let accumulatedDurationMs = 0;
            let currentSubTask = null;
            
            for (let i = 0; i < breakdown.length; i++) {
                const parts = breakdown[i].split(' ');
                const durationMinutes = parseInt(parts[0]);
                const durationMs = durationMinutes * 60 * 1000;
                
                const subTaskStartTime = new Date(currentItemStart.getTime() + accumulatedDurationMs);
                const subTaskEndTime = new Date(currentItemStart.getTime() + accumulatedDurationMs + durationMs);

                if (now >= subTaskStartTime && now < subTaskEndTime) {
                    currentSubTask = breakdown[i];
                    currentSubTaskEnd = subTaskEndTime;
                    
                    const subDiff = currentSubTaskEnd - now;
                    subTaskEl.innerText = `${currentSubTask} (Ends in ${formatTime(subDiff)})`;

                    if (Math.floor(subDiff / 1000) === 0 && i !== lastSubTaskIndex) {
                        playAlarm(); 
                    }
                    lastSubTaskIndex = i;

                    break;
                }
                
                accumulatedDurationMs += durationMs;
            }
            
            if (!currentSubTask) {
                subTaskEl.innerText = "Execution Mode: Task Transition";
                currentSubTaskEnd = null;
                lastSubTaskIndex = -1;
            }
        }

        // --- Main Update Loop ---
        function updateTimer() {
            const now = new Date();
            let currentTaskIndex = -1;
            
            for (let i = 0; i < schedule.length; i++) {
                let start = getTodayDate(schedule[i].start);
                let end = getTodayDate(schedule[i].end);

                // Handle tasks crossing midnight
                if (end < start) {
                    if (now >= start) {
                        end.setDate(end.getDate() + 1);
                    } else if (now < end) {
                        start.setDate(start.getDate() - 1);
                    }
                }

                if (now >= start && now < end) {
                    currentTaskIndex = i;
                    const diff = end - now;
                    
                    document.getElementById('taskName').innerText = schedule[i].task;
                    document.getElementById('timer').innerText = formatTime(diff);
                    
                    updateSubTask(now, schedule[i], start);

                    if (currentTaskIndex !== lastCycleIndex) {
                        playAlarm(); 
                        if (schedule[i].type === 'work') {
                            updateQuote();
                        }
                        
                        // üí° FIX IMPLEMENTATION: Re-render the list when the task changes
                        reorderScheduleList(currentTaskIndex); 
                    }
                    lastCycleIndex = currentTaskIndex;

                    if (Math.floor(diff / 1000) === 0 && Math.floor(diff/1000) !== lastSeconds) {
                        playAlarm(); 
                    }
                    lastSeconds = Math.floor(diff / 1000);

                    const timerEl = document.getElementById('timer');
                    timerEl.style.color = (diff < 600000 && diff > 0) ? 'var(--accent)' : 'var(--primary)'; 
                    timerEl.style.animation = (diff < 300000 && diff > 0) ? 'pulse 1s infinite' : 'none'; 

                    let nextIdx = (i + 1) % schedule.length;
                    document.getElementById('nextTask').innerText = `NEXT: ${schedule[nextIdx].task} @ ${schedule[nextIdx].start}`;

                    break;
                }
            }
            
            // Handle cases where the time is before the first task or after the last task
            if (currentTaskIndex === -1 && lastCycleIndex !== -1) {
                // If we finished the final task, re-render to push all tasks to 'completed'
                reorderScheduleList(schedule.length); 
                lastCycleIndex = -1;
            } else if (currentTaskIndex !== -1) {
                 // Even if the index didn't change, apply the active class just in case of initial load or minor glitch
                const activeItem = document.getElementById(`item-${currentTaskIndex}`);
                if (activeItem) {
                    activeItem.classList.add('active');
                }
            }
        }
        
        // --- Initialization ---
        function startProtocol() {
            document.getElementById('overlay').style.display = 'none';
            protocolStarted = true;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            updateNeetCounter();
            updateQuote(); 
            
            // Initial call to updateTimer handles the first rendering/ordering
            updateTimer(); 
            
            setInterval(updateTimer, 1000);
            setInterval(updateNeetCounter, 60000); // Update NEET counter every minute
        }

        // --- Animation Definition ---
        const styleSheet = document.createElement("style");
        styleSheet.type = "text/css";
        styleSheet.innerText += `
            @keyframes pulse {
                0% { opacity: 0.8; transform: scale(1); }
                50% { opacity: 1; transform: scale(1.01); }
                100% { opacity: 0.8; transform: scale(1); }
            }
        `;
        document.head.appendChild(styleSheet);

    </script>
</body>
</html>
