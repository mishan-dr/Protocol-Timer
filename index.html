<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° AIIMS WAR PROTOCOL - SNIPER MODE</title>
    
    <meta name="theme-color" content="#d9534f">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="application-name" content="AIIMS WAR">
    
    <style>
        :root {
            --bg-color: #f0f3f8; 
            --card-bg: #ffffff;
            --primary: #d9534f; 
            --water: #00bcd4; 
            
            /* Subject Colors */
            --bio: #4caf50;    /* Green */
            --chem: #2196f3;   /* Blue */
            --phy: #d9534f;    /* Red */
            
            --text: #1c2a38;
            --dim: #5c6c7c;
            --border: #e3e8ee;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --font-main: 'Roboto', sans-serif;
        }

        body.dark-mode {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text: #e0e0e0;
            --dim: #757575;
            --border: #333333;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap');

        * { box-sizing: border-box; margin: 0; padding: 0; transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease; }
        
        /* DESKTOP DEFAULT: Locked Layout */
        body {
            background-color: var(--bg-color);
            color: var(--text);
            font-family: var(--font-main);
            height: 100vh; 
            width: 100vw;
            display: flex;
            flex-direction: column;
            padding: 10px;
            overflow: hidden; 
        }

        /* MOBILE OVERRIDE: Scrolling Layout */
        @media (max-width: 1000px) {
            body { 
                height: auto; 
                overflow-y: auto; 
                display: block; 
            }
            .container { 
                flex-direction: column; 
                height: auto !important; 
                display: flex;
            }
            .left-panel, .right-panel { 
                height: auto !important; 
                width: 100%; 
                margin-bottom: 15px;
            }
            .dashboard-head { min-height: 220px; }
            .schedule-box { height: 400px; } /* Fixed height for mobile scroll inside box */
            .quote-box { display: none; } 
        }

        /* --- LAYOUT --- */
        .container { 
            display: flex; 
            width: 100%; 
            height: 100%; 
            gap: 10px; 
            margin: 0 auto;
            max-width: 1600px;
        }
        /* Min-height: 0 is essential for nested flex scrolling */
        .left-panel { flex: 3; display: flex; flex-direction: column; gap: 10px; height: 100%; min-height: 0; }
        .right-panel { flex: 2; display: flex; flex-direction: column; gap: 10px; height: 100%; min-height: 0; }

        /* --- SNOWFALL --- */
        #snowfall-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; opacity: 0.8; }
        .snowflake { position: absolute; width: 3px; height: 3px; background: rgba(255, 255, 255, 0.9); border-radius: 50%; opacity: 0; animation: fall linear infinite; }
        @keyframes fall { 0% { transform: translateY(-10vh) translateX(0); opacity: 0; } 5% { opacity: 0.9; } 95% { opacity: 0.9; } 100% { transform: translateY(100vh) translateX(var(--drift)); opacity: 0; } }

        /* --- CONTROLS --- */
        .controls-container { position: fixed; top: 10px; right: 10px; display: flex; gap: 8px; z-index: 1100; }
        .control-btn { background: var(--card-bg); border: 1px solid var(--border); color: var(--text); padding: 5px; border-radius: 50%; width: 35px; height: 35px; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: var(--shadow); font-size: 1rem; }
        
        /* --- OVERLAY --- */
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); display: flex; justify-content: center; align-items: center; flex-direction: column; z-index: 1000; }
        #overlay h1 { font-size: 2rem; color: var(--primary); margin-bottom: 20px; font-weight: 900; }
        #overlay button { padding: 12px 30px; font-size: 1rem; font-weight: 700; color: white; background-color: var(--primary); border: none; border-radius: 50px; cursor: pointer; }

        /* --- STAR TRAIL (UNIFORM SPEED) --- */
        .star-box { position: relative; overflow: hidden; }
        .star-line { position: absolute; border-radius: 2px; opacity: 0; }
        
        .star-top { 
            top: 0; left: 0; width: 100%; height: 3px; 
            background: linear-gradient(90deg, transparent 70%, var(--primary)); 
            animation: animate-top 4s linear infinite;
        }
        .star-right { 
            top: 0; right: 0; width: 3px; height: 100%; 
            background: linear-gradient(180deg, transparent 70%, var(--primary)); 
            animation: animate-right 4s linear infinite;
            animation-delay: 1s;
        }
        .star-bottom { 
            bottom: 0; right: 0; width: 100%; height: 3px; 
            background: linear-gradient(270deg, transparent 70%, var(--primary)); 
            animation: animate-bottom 4s linear infinite;
            animation-delay: 2s;
        }
        .star-left { 
            bottom: 0; left: 0; width: 3px; height: 100%; 
            background: linear-gradient(0deg, transparent 70%, var(--primary)); 
            animation: animate-left 4s linear infinite;
            animation-delay: 3s;
        }

        @keyframes animate-top { 0% { left: -100%; opacity: 1; } 50% { left: 100%; opacity: 1; } 51%, 100% { left: 100%; opacity: 0; } }
        @keyframes animate-right { 0% { top: -100%; opacity: 1; } 50% { top: 100%; opacity: 1; } 51%, 100% { top: 100%; opacity: 0; } }
        @keyframes animate-bottom { 0% { right: -100%; opacity: 1; } 50% { right: 100%; opacity: 1; } 51%, 100% { right: 100%; opacity: 0; } }
        @keyframes animate-left { 0% { bottom: -100%; opacity: 1; } 50% { bottom: 100%; opacity: 1; } 51%, 100% { bottom: 100%; opacity: 0; } }

        /* --- WIDGETS --- */
        .dashboard-head { 
            background-color: var(--card-bg); padding: 15px; border-radius: 12px; 
            box-shadow: var(--shadow); text-align: center; border-top: 4px solid var(--primary); 
            display: flex; flex-direction: column; justify-content: center; 
            flex: 0 0 auto; 
            min-height: 200px;
        }
        .protocol-title { font-size: 0.8rem; font-weight: 800; color: var(--primary); letter-spacing: 2px; text-transform: uppercase; }
        .countdown { font-size: 4.5rem; font-weight: 900; color: var(--text); line-height: 0.9; margin: 5px 0; letter-spacing: -2px;}
        .current-task-main { font-size: 1.4rem; font-weight: 700; color: var(--dim); margin: 0 0 10px; text-transform: uppercase; }
        
        .sub-task-timer { 
            padding: 10px 15px; background-color: var(--bg-color); border-radius: 8px; 
            font-size: 1.1rem; border-left: 5px solid var(--primary); text-align: left; 
        }
        .sub-task-timer strong { color: var(--dim); font-size: 0.75rem; display: block; font-weight: 700; text-transform: uppercase;}
        .sub-task-timer span { font-weight: 800; color: var(--primary); }

        .lec-command-box { 
            background-color: var(--card-bg); padding: 15px; border-radius: 12px; 
            box-shadow: var(--shadow); border: 1px solid var(--border); 
            flex: 1; /* Allow growing */
            min-height: 0; /* ALLOW SHRINKING FOR SCROLLBAR */
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .lec-header { font-size: 0.9rem; font-weight: 800; color: var(--text); text-transform: uppercase; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .lec-global-stats { display: flex; justify-content: space-between; margin-bottom: 10px; background: var(--bg-color); padding: 8px; border-radius: 8px; }
        .lg-item { text-align: center; flex: 1; }
        .lg-val { display: block; font-size: 1.4rem; font-weight: 900; line-height: 1; color: var(--text); }
        .lg-lbl { font-size: 0.6rem; font-weight: 700; color: var(--dim); text-transform: uppercase; margin-top: 2px; }

        .subject-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 5px; }
        .sub-card { background: var(--bg-color); padding: 8px; border-radius: 8px; text-align: center; border: 1px solid var(--border); }
        .sub-name { font-size: 0.7rem; font-weight: 800; margin-bottom: 2px; }
        .sub-count { font-size: 1.2rem; font-weight: 900; }
        .bio .sub-name, .bio .sub-count { color: var(--bio); } .chem .sub-name, .chem .sub-count { color: var(--chem); } .phy .sub-name, .phy .sub-count { color: var(--phy); }
        
        .daily-bar-sec { margin-top: 5px; }
        .db-label { display: flex; justify-content: space-between; font-size: 0.7rem; font-weight: 700; color: var(--dim); margin-bottom: 3px; }
        .stat-bar-bg { width: 100%; height: 8px; background-color: var(--border); border-radius: 4px; overflow: hidden; }
        
        /* RESTORED SINGLE WHITE TIP STYLE */
        #dailyLecBar {
            height: 100%;
            width: 0%;
            transition: width 0.5s;
            border-radius: 4px;
            background: linear-gradient(90deg, var(--text) 0%, var(--text) 85%, #ffffff 100%);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.4);
        }

        .analytics-box { 
            background-color: var(--card-bg); padding: 15px; border-radius: 12px; 
            box-shadow: var(--shadow); border: 1px solid var(--border); 
            flex: 0.8; display: flex; flex-direction: column; justify-content: center;
            min-height: 160px;
        }
        .analytics-box h3 { color: var(--text); font-size: 0.9rem; margin-bottom: 10px; font-weight: 800; text-transform: uppercase; }
        .stat-row { margin-bottom: 8px; }
        .stat-header { display: flex; justify-content: space-between; font-size: 0.75rem; font-weight: 700; margin-bottom: 4px; color: var(--dim); }
        .stat-bar-fill { height: 100%; width: 0%; transition: width 0.5s; border-radius: 4px; }

        /* 2. RIGHT PANEL WIDGETS */
        .neet-detailed-box { 
            background: var(--card-bg); padding: 12px; border-radius: 12px; 
            border: 1px solid var(--border); box-shadow: var(--shadow); 
            border-top: 4px solid var(--primary); height: 80px;
            display: flex; flex-direction: column; justify-content: center;
            flex-shrink: 0;
        }
        .neet-main-label { text-align: center; font-size: 0.85rem; font-weight: 900; color: var(--primary); margin-bottom: 5px; letter-spacing: 1px; }
        .neet-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
        .neet-grid-item { text-align: center; border-right: 1px solid var(--border); }
        .neet-grid-item:last-child { border-right: none; }
        .ng-val { font-size: 1.1rem; font-weight: 900; color: var(--primary); display: block; line-height: 1; }
        .ng-lbl { font-size: 0.55rem; font-weight: 700; color: var(--dim); text-transform: uppercase; margin-top: 2px; display: block;}

        .schedule-box { 
            background-color: var(--card-bg); border-radius: 12px; box-shadow: var(--shadow); 
            display: flex; flex-direction: column; border: 1px solid var(--border); overflow: hidden; 
            flex: 2; /* Main grower */
            min-height: 0; /* CRITICAL FOR FLEX SCROLL */
        }
        .schedule-header { padding: 10px 15px; background: var(--bg-color); border-bottom: 1px solid var(--border); font-weight: 800; color: var(--text); font-size: 0.85rem; flex-shrink: 0; }
        .schedule-list { padding: 0; overflow-y: auto; flex: 1; display: flex; flex-direction: column; }
        .schedule-list::-webkit-scrollbar { width: 5px; }
        .schedule-list::-webkit-scrollbar-thumb { background: var(--dim); border-radius: 5px; }

        .schedule-item { display: flex; justify-content: space-between; padding: 8px 15px; border-bottom: 1px solid var(--border); color: var(--dim); font-size: 0.8rem; }
        .schedule-item.active { background-color: var(--card-bg); border-left: 4px solid var(--primary); color: var(--text); font-weight: 700; font-size: 0.85rem; order: -1; }
        .schedule-item.completed { opacity: 0.5; background: rgba(0,0,0,0.02); order: 100; }
        .schedule-divider { text-align: center; font-size: 0.65rem; color: var(--dim); padding: 4px; background: var(--bg-color); font-weight: 700; border-bottom:1px solid var(--border); order: 99;}
        .time-col { font-weight: 700; min-width: 70px; }

        .widget-box { 
            background-color: var(--card-bg); padding: 12px; border-radius: 8px; 
            box-shadow: var(--shadow); border: 1px solid var(--border); 
            flex: 1; display: flex; flex-direction: column; 
            min-height: 0; /* CRITICAL FOR FLEX SCROLL */
        }
        .widget-box h3 { color: var(--primary); font-size: 0.85rem; margin-bottom: 8px; font-weight: 800; flex-shrink: 0;}
        
        /* ENABLE INTERNAL SCROLLING FOR WATER */
        .water-list { list-style: none; font-size: 0.75rem; overflow-y: auto; flex: 1; display: flex; flex-direction: column;}
        .water-list::-webkit-scrollbar { width: 5px; }
        .water-list::-webkit-scrollbar-thumb { background: var(--dim); border-radius: 5px; }
        .water-item { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px dashed var(--border); color: var(--text); order: 0;}
        .water-item.done { text-decoration: line-through; opacity: 0.4; order: 100; } 

        .graph-box { 
            background: var(--card-bg); padding: 10px; border-radius: 8px; 
            box-shadow: var(--shadow); border: 1px solid var(--border); 
            height: 70px; display: flex; flex-direction: column; justify-content: center; flex-shrink: 0;
        }
        .graph-title { font-size: 0.65rem; font-weight: 800; color: var(--dim); text-transform: uppercase; margin-bottom: 2px; }
        canvas#intensityGraph { width: 100%; height: 100%; }

        .quote-box { 
            padding: 10px; background: var(--card-bg); border-radius: 12px; 
            border-left: 4px solid var(--primary); box-shadow: var(--shadow); 
            height: 50px; display: flex; align-items: center; justify-content: center; text-align: center; flex-shrink: 0;
        }
        #rotatingQuote { font-style: italic; font-weight: 500; color: var(--text); font-size: 0.8rem; line-height: 1.2; }

    </style>
</head>
<body>

    <audio id="alarmSound" preload="auto"></audio>
    <div id="snowfall-layer"></div>
    
    <div class="controls-container">
        <button class="control-btn" onclick="toggleTheme()" id="themeBtn">üåô</button>
    </div>

    <div id="overlay">
        <h1>ü¶Å WAR PROTOCOL</h1>
        <button onclick="startProtocol()">INITIATE SNIPER MODE</button>
        <p style="margin-top:20px; color:var(--dim);">Bio: Green ‚Ä¢ Chem: Blue ‚Ä¢ Phy: Red</p>
    </div>

    <div class="container">
        <div class="left-panel">
            <div class="dashboard-head star-box">
                <div class="star-line star-top"></div><div class="star-line star-right"></div>
                <div class="star-line star-bottom"></div><div class="star-line star-left"></div>

                <div class="protocol-title">Current Objective</div>
                <div class="current-task-main" id="taskName">LOADING...</div>
                <div class="countdown" id="timer">00:00:00</div>
                
                <div class="sub-task-timer" id="subTaskBox">
                    <strong>CURRENT FOCUS</strong> 
                    <span id="subTaskName">Initializing...</span>
                </div>
            </div>

            <div class="lec-command-box">
                <div class="lec-header"><span>üìö Lecture Command</span><span style="color:var(--primary)">Target: Feb 23</span></div>
                <div class="lec-global-stats">
                    <div class="lg-item"><span class="lg-val" id="lecDoneVal" style="color:var(--bio)">0</span><span class="lg-lbl">Done</span></div>
                    <div class="lg-item"><span class="lg-val" id="lecRemVal" style="color:var(--primary)">624</span><span class="lg-lbl">Left</span></div>
                    <div class="lg-item"><span class="lg-val" id="lecDaysVal" style="color:var(--dim)">0</span><span class="lg-lbl">Days</span></div>
                </div>
                <div class="subject-grid">
                    <div class="sub-card bio"><div class="sub-name">BIO</div><div class="sub-count" id="bioCount">0/3</div></div>
                    <div class="sub-card chem"><div class="sub-name">CHEM</div><div class="sub-count" id="chemCount">0/3</div></div>
                    <div class="sub-card phy"><div class="sub-name">PHY</div><div class="sub-count" id="phyCount">0/3</div></div>
                </div>
                <div class="daily-bar-sec">
                    <div class="db-label"><span>DAILY PROGRESS</span><span id="dailyLecTxt">0/8</span></div>
                    <div class="stat-bar-bg"><div id="dailyLecBar"></div></div>
                </div>
            </div>

            <div class="analytics-box">
                <h3>üìä Daily Metrics</h3>
                <div class="stat-row">
                    <div class="stat-header"><span style="color:var(--water)">üíß HYDRATION</span><span class="stat-val" id="metricWaterVal">0/3500</span></div>
                    <div class="stat-bar-bg"><div class="stat-bar-fill" id="metricWaterBar" style="background-color:var(--water)"></div></div>
                </div>
                <div class="stat-row">
                    <div class="stat-header"><span style="color:#ff9800">üß† REVISION</span><span class="stat-val" id="valRev">0m</span></div>
                    <div class="stat-bar-bg"><div class="stat-bar-fill" id="barRev" style="background-color:#ff9800"></div></div>
                </div>
                <div class="stat-row">
                    <div class="stat-header"><span style="color:#9c27b0">‚ùì QUESTIONS</span><span class="stat-val" id="valQues">0m</span></div>
                    <div class="stat-bar-bg"><div class="stat-bar-fill" id="barQues" style="background-color:#9c27b0"></div></div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="neet-detailed-box">
                <div class="neet-main-label">NEET 2026 (AIIMS)</div>
                <div class="neet-grid">
                    <div class="neet-grid-item"><span class="ng-val" id="nt-months">00</span><span class="ng-lbl">Months</span></div>
                    <div class="neet-grid-item"><span class="ng-val" id="nt-weeks">00</span><span class="ng-lbl">Weeks</span></div>
                    <div class="neet-grid-item"><span class="ng-val" id="nt-days">00</span><span class="ng-lbl">Days</span></div>
                    <div class="neet-grid-item"><span class="ng-val" id="nt-hours">00</span><span class="ng-lbl">Hours</span></div>
                </div>
            </div>

            <div class="schedule-box">
                <div class="schedule-header">MISHAN FEED</div>
                <div class="schedule-list" id="scheduleList"></div>
            </div>

            <div class="widget-box">
                <h3>üö∞ Water Log</h3>
                <ul class="water-list" id="fullWaterList"></ul>
            </div>

            <div class="graph-box">
                <div class="graph-title">Day Intensity (Live)</div>
                <canvas id="intensityGraph"></canvas>
            </div>

            <div class="quote-box">
                <span id="rotatingQuote">"Consistency is the cheat code."</span>
            </div>
        </div>
    </div>

    <script>
        // --- MANIFEST INJECTION ---
        const manifest = { "name": "AIIMS WAR PROTOCOL", "short_name": "AIIMS WAR", "start_url": ".", "display": "standalone", "background_color": "#d9534f", "theme_color": "#d9534f", "icons": [{ "src": "https://cdn-icons-png.flaticon.com/512/2913/2913465.png", "sizes": "192x192", "type": "image/png" }] };
        const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const link = document.createElement('link'); link.rel = 'manifest'; link.href = URL.createObjectURL(blob); document.head.appendChild(link);

        // --- DATA ---
        const schedule = [
            { start: "08:00", end: "08:30", task: "üåÖ WAKE UP + HYDRATE", type: "prep", breakdown: [] },
            { start: "08:30", end: "10:00", task: "‚öîÔ∏è CYCLE 1 (BIO)", type: "work", breakdown: ["25 min Revision", "20 min Questions", "45 min Lecture"] },
            { start: "10:00", end: "10:15", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "10:15", end: "11:45", task: "‚öîÔ∏è CYCLE 2 (CHEM)", type: "work", breakdown: ["25 min Revision", "20 min Questions", "45 min Lecture"] },
            { start: "11:45", end: "12:15", task: "üí™ WORKOUT + BATH", type: "prep", breakdown: [] },
            { start: "12:15", end: "13:45", task: "‚öîÔ∏è CYCLE 3 (PHY)", type: "work", breakdown: ["25 min Revision", "20 min Questions", "45 min Lecture"] },
            { start: "13:45", end: "14:00", task: "üçΩÔ∏è LUNCH (No Phone)", type: "break", breakdown: [] },
            { start: "14:00", end: "15:30", task: "‚öîÔ∏è CYCLE 4 (BIO)", type: "work", breakdown: ["25 min Revision", "20 min Questions", "45 min Lecture"] },
            { start: "15:30", end: "15:45", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "15:45", end: "17:15", task: "‚öîÔ∏è CYCLE 5 (CHEM)", type: "work", breakdown: ["25 min Revision", "20 min Questions", "45 min Lecture"] },
            { start: "17:15", end: "17:30", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "17:30", end: "19:00", task: "‚öîÔ∏è CYCLE 6 (PHY)", type: "work", breakdown: ["25 min Revision", "20 min Questions", "45 min Lecture"] },
            { start: "19:00", end: "19:15", task: "üçΩÔ∏è DINNER", type: "break", breakdown: [] },
            { start: "19:15", end: "20:45", task: "‚öîÔ∏è CYCLE 7 (BIO)", type: "work", breakdown: ["25 min Revision", "20 min Questions", "45 min Lecture"] },
            { start: "20:45", end: "21:00", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "21:00", end: "22:30", task: "‚öîÔ∏è CYCLE 8 (CHEM)", type: "work", breakdown: ["25 min Revision", "20 min Questions", "45 min Lecture"] },
            { start: "22:30", end: "22:45", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "22:45", end: "00:15", task: "‚öîÔ∏è CYCLE 9 (PHY - NOTES)", type: "work", breakdown: ["30 min Revision", "30 min Questions", "30 min Notes"] },
            { start: "00:15", end: "00:45", task: "üßò COOL DOWN", type: "prep", breakdown: [] },
            { start: "00:45", end: "01:00", task: "üò¥ PRE-SLEEP HYDRATION", type: "prep", breakdown: [] },
            { start: "01:00", end: "08:00", task: "üí§ SLEEP", type: "sleep", breakdown: [] }
        ];

        const waterPlan = [
            { time: "08:00", ml: 400 }, { time: "10:00", ml: 250 }, { time: "11:45", ml: 300 },
            { time: "13:45", ml: 400 }, { time: "15:30", ml: 300 }, { time: "17:15", ml: 250 },
            { time: "19:00", ml: 400 }, { time: "20:45", ml: 300 }, { time: "22:30", ml: 300 },
            { time: "00:15", ml: 200 }, { time: "00:45", ml: 400 }
        ];

        const quotes = [ "Success is the sum of small efforts.", "Do it tired. Do it anyway.", "The only way to fail is to stop moving.", "Action breeds confidence.", "1% better every day." ];
        
        // Colors
        const COL_BIO = '#4caf50';
        const COL_CHEM = '#2196f3';
        const COL_PHY = '#d9534f';
        const COL_DEF = '#d9534f'; 

        const LEC_TOTAL = 624; const LEC_START_DATE = new Date('2025-12-07T00:00:00');
        const NEET_TARGET_DATE = new Date('May 4, 2026 14:00:00'); const TOTAL_WATER_ML = 3500; 
        
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let lastSeconds = -1, lastCycleIndex = -1, lastSubTaskIndex = -1;
        let totalRevTarget = 0, totalQuesTarget = 0;

        window.addEventListener('DOMContentLoaded', () => {
            if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
            schedule.forEach(s => { if(s.type === 'work' && s.breakdown.length) { s.breakdown.forEach(b => { if(b.includes("Revision")) totalRevTarget += parseInt(b); if(b.includes("Questions")) totalQuesTarget += parseInt(b); if(b.includes("Notes")) totalRevTarget += parseInt(b); }); } });
            document.getElementById('fullWaterList').innerHTML = waterPlan.map(p => `<li class="water-item"><span>${p.time}</span> <span>${p.ml}ml</span></li>`).join('');
            startSnowfall(); rotateQuote(); setInterval(rotateQuote, 45 * 60000); 
            setInterval(drawGraph, 60000); 
            window.addEventListener('resize', drawGraph);
        });

        function toggleTheme() { document.body.classList.toggle('dark-mode'); localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light'); drawGraph(); }
        function rotateQuote() { document.getElementById('rotatingQuote').innerText = `"${quotes[Math.floor(Math.random() * quotes.length)]}"`; }

        function getMinutesFromStart(timeStr, isNextDay) {
            const [h, m] = timeStr.split(':').map(Number);
            let mins = h * 60 + m;
            let relative = mins - 480; 
            if (relative < 0) relative += 1440; 
            if (isNextDay) relative += 1440;
            return relative;
        }

        function drawGraph() {
            const canvas = document.getElementById('intensityGraph');
            const ctx = canvas.getContext('2d');
            const rect = canvas.parentNode.getBoundingClientRect();
            canvas.width = rect.width; canvas.height = rect.height;
            const primary = getComputedStyle(document.documentElement).getPropertyValue('--primary').trim();
            const w = canvas.width; const h = canvas.height;
            const totalMinutes = 1440;
            const now = new Date();
            let currentMins = now.getHours() * 60 + now.getMinutes();
            let relativeNow = currentMins - 480; 
            if (relativeNow < 0) relativeNow += 1440;
            if (relativeNow > 1440) relativeNow = 1440;
            const xPerMin = w / totalMinutes;
            function getY(type) { if (type === 'work') return h * 0.2; if (type === 'prep') return h * 0.6; return h * 0.9; }

            ctx.clearRect(0, 0, w, h);
            ctx.beginPath(); ctx.moveTo(0, h);
            schedule.forEach((s) => {
                let sTime = getMinutesFromStart(s.start, s.start.startsWith("0") && parseInt(s.start) < 8);
                let eTime = getMinutesFromStart(s.end, s.end.startsWith("0") && parseInt(s.end) < 8);
                if(eTime < sTime) eTime += 1440;
                let x1 = sTime * xPerMin; let x2 = eTime * xPerMin; let y = getY(s.type);
                ctx.lineTo(x1, y); ctx.lineTo(x2, y);
            });
            ctx.lineTo(w, h); ctx.strokeStyle = primary; ctx.lineWidth = 2; ctx.globalAlpha = 0.2; ctx.stroke();

            ctx.save(); ctx.beginPath(); ctx.rect(0, 0, relativeNow * xPerMin, h); ctx.clip();
            ctx.beginPath(); ctx.moveTo(0, h);
             schedule.forEach((s) => {
                let sTime = getMinutesFromStart(s.start, s.start.startsWith("0") && parseInt(s.start) < 8);
                let eTime = getMinutesFromStart(s.end, s.end.startsWith("0") && parseInt(s.end) < 8);
                if(eTime < sTime) eTime += 1440;
                let x1 = sTime * xPerMin; let x2 = eTime * xPerMin; let y = getY(s.type);
                ctx.lineTo(x1, y); ctx.lineTo(x2, y);
            });
            ctx.lineTo(w, h); ctx.globalAlpha = 1.0; ctx.lineWidth = 3; ctx.shadowBlur = 10; ctx.shadowColor = primary; ctx.stroke();
            ctx.restore();
            
            // GLOWING DOT (Restored)
            let currentY = getY(schedule.find(s=> {
                let sTime = getMinutesFromStart(s.start, s.start.startsWith("0") && parseInt(s.start) < 8);
                let eTime = getMinutesFromStart(s.end, s.end.startsWith("0") && parseInt(s.end) < 8);
                if(eTime < sTime) eTime += 1440;
                return relativeNow >= sTime && relativeNow < eTime;
            })?.type || 'break');
            
            ctx.beginPath(); 
            ctx.arc(relativeNow * xPerMin, currentY, 5, 0, Math.PI*2);
            ctx.fillStyle = '#ffffff'; 
            ctx.shadowColor = primary; 
            ctx.shadowBlur = 15; 
            ctx.fill();
        }

        function startProtocol() { document.getElementById('overlay').style.display = 'none'; if(audioCtx.state === 'suspended') audioCtx.resume(); setInterval(() => { const now = new Date(); updateTimer(now); updateLectureDetailed(now); updateAnalytics(now); updateNeetCounterDetailed(); }, 1000); updateNeetCounterDetailed(); drawGraph(); }
        function getTodayDate(t) { const now = new Date(); const [h,m] = t.split(':').map(Number); return new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m, 0); }
        function formatTime(ms) { const s = Math.floor(ms/1000); return `${Math.floor(s/3600).toString().padStart(2,'0')}:${Math.floor((s%3600)/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`; }
        
        function updateTimer(now) {
            let currentTaskIndex = -1;
            for (let i = 0; i < schedule.length; i++) {
                let start = getTodayDate(schedule[i].start); let end = getTodayDate(schedule[i].end);
                if (end < start) { if (now >= start) end.setDate(end.getDate() + 1); else if (now < end) start.setDate(start.getDate() - 1); }
                if (now >= start && now < end) {
                    currentTaskIndex = i; const diff = end - now;
                    document.getElementById('taskName').innerText = schedule[i].task;
                    document.getElementById('timer').innerText = formatTime(diff);
                    let subText = "Execution Mode"; let currentSubIndex = -1;
                    if(schedule[i].breakdown.length) {
                        let acc = 0; schedule[i].breakdown.forEach((b, idx) => { let dur = parseInt(b)*60000; let subEnd = new Date(start.getTime()+acc+dur); if(now < subEnd && currentSubIndex === -1) { subText = b; currentSubIndex = idx; } acc += dur; });
                    } else if (schedule[i].type === 'break') subText = "Recover & Hydrate";
                    document.getElementById('subTaskName').innerText = subText;
                    if (currentSubIndex !== lastSubTaskIndex && lastSubTaskIndex !== -1) playAlarm(); lastSubTaskIndex = currentSubIndex;
                    
                    if (currentTaskIndex !== lastCycleIndex) { 
                        playAlarm(); renderSchedule(currentTaskIndex); 
                        let newColor = COL_DEF;
                        if(schedule[i].task.includes("BIO")) newColor = COL_BIO;
                        else if(schedule[i].task.includes("CHEM")) newColor = COL_CHEM;
                        else if(schedule[i].task.includes("PHY")) newColor = COL_PHY;
                        document.documentElement.style.setProperty('--primary', newColor);
                        drawGraph(); 
                    }
                    lastCycleIndex = currentTaskIndex; 
                    if(Math.floor(diff/1000) === 0 && Math.floor(diff/1000) !== lastSeconds) playAlarm(); lastSeconds = Math.floor(diff/1000);
                    break;
                }
            }
            if (currentTaskIndex === -1 && lastCycleIndex !== -1) renderSchedule(schedule.length);
        }

        function updateLectureDetailed(now) {
            const startOfDay = new Date(LEC_START_DATE.getFullYear(), LEC_START_DATE.getMonth(), LEC_START_DATE.getDate());
            const diffTime = Math.abs(now - startOfDay); const daysPassed = Math.floor(diffTime / (1000 * 60 * 60 * 24)); 
            let lecCompletedToday = 0; let bio = 0, chem = 0, phy = 0;
            for (let i = 0; i < schedule.length; i++) {
                const item = schedule[i]; if(item.type !== 'work') continue;
                let start = getTodayDate(item.start); let end = getTodayDate(item.end);
                if (end < start) { if (now >= start) end.setDate(end.getDate() + 1); else if (now < end) start.setDate(start.getDate() - 1); }
                if (now > end && i < 17) { 
                    if (i < 17) lecCompletedToday++; 
                    if(item.task.includes("BIO")) bio++; 
                    else if(item.task.includes("CHEM")) chem++; 
                    else if(item.task.includes("PHY")) phy++; 
                }
            }
            const globalDone = (daysPassed * 8) + lecCompletedToday; const remaining = Math.max(0, LEC_TOTAL - globalDone);
            document.getElementById('lecDoneVal').innerText = globalDone; document.getElementById('lecRemVal').innerText = remaining; document.getElementById('lecDaysVal').innerText = Math.ceil(remaining / 8);
            document.getElementById('bioCount').innerText = `${Math.min(3, bio)}/3`; document.getElementById('chemCount').innerText = `${Math.min(3, chem)}/3`; document.getElementById('phyCount').innerText = `${Math.min(3, phy)}/3`;
            const pct = Math.min(100, ((bio+chem+phy) / 9) * 100); 
            document.getElementById('dailyLecBar').style.width = pct + "%"; document.getElementById('dailyLecTxt').innerText = `${bio+chem+phy}/9`;
        }

        function updateAnalytics(now) {
            let revDone = 0, quesDone = 0;
            schedule.forEach(item => {
                if (item.type !== 'work') return;
                let start = getTodayDate(item.start); let end = getTodayDate(item.end);
                if (end < start) { if (now >= start) end.setDate(end.getDate() + 1); else if (now < end) start.setDate(start.getDate() - 1); } if (now < start) return; 
                let cycleAcc = 0; item.breakdown.forEach(part => { let mins = parseInt(part); let partStart = new Date(start.getTime() + cycleAcc); let partEnd = new Date(partStart.getTime() + mins*60000); let minsDone = 0; if (now >= partEnd) minsDone = mins; else if (now > partStart) minsDone = Math.floor((now - partStart)/60000); if(part.includes("Revision") || part.includes("Notes")) revDone += minsDone; if(part.includes("Questions")) quesDone += minsDone; cycleAcc += mins*60000; });
            });
            updateBar('barRev', 'valRev', revDone, totalRevTarget); updateBar('barQues', 'valQues', quesDone, totalQuesTarget);
            let waterConsumed = 0; let items = document.querySelectorAll('.water-item');
            waterPlan.forEach((entry, idx) => { let t = getTodayDate(entry.time); if(entry.time.startsWith("00") && now.getHours()>12) t.setDate(t.getDate()+1); if(now >= t) { waterConsumed += entry.ml; if(items[idx]) items[idx].classList.add('done'); } });
            updateBar('metricWaterBar', 'metricWaterVal', waterConsumed, TOTAL_WATER_ML, '');
        }

        function updateBar(barId, txtId, val, total, suffix='m') { const pct = Math.min(100, (val/total)*100); document.getElementById(barId).style.width = pct + "%"; document.getElementById(txtId).innerText = `${val}/${total}${suffix}`; }
        function renderSchedule(idx) { const list = document.getElementById('scheduleList'); list.innerHTML = ''; schedule.forEach((s, i) => { const div = document.createElement('div'); div.className = `schedule-item ${i === idx ? 'active' : (i < idx ? 'completed' : '')}`; div.innerHTML = `<div class="time-col">${s.start}</div><div style="flex:1">${s.task}</div>`; list.appendChild(div); }); const divider = document.createElement('div'); divider.className = "schedule-divider"; divider.innerText = "‚¨á COMPLETED ‚¨á"; list.appendChild(divider); }
        function updateNeetCounterDetailed() { const now = new Date(); let diff = NEET_TARGET_DATE - now; if(diff < 0) diff = 0; const days = Math.floor(diff / (1000 * 60 * 60 * 24)); const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)); const months = Math.floor(days / 30.44); const weeks = Math.floor((days % 30.44) / 7); const rDays = Math.floor((days % 30.44) % 7); document.getElementById('nt-months').innerText = String(months).padStart(2,'0'); document.getElementById('nt-weeks').innerText = String(weeks).padStart(2,'0'); document.getElementById('nt-days').innerText = String(rDays).padStart(2,'0'); document.getElementById('nt-hours').innerText = String(hours).padStart(2,'0'); }
        function playAlarm() { if (audioCtx.state === 'suspended') audioCtx.resume(); const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.frequency.setValueAtTime(880, audioCtx.currentTime); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.3); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.3); }
        function startSnowfall() { const layer = document.getElementById('snowfall-layer'); for(let i=0; i<30; i++) { const div = document.createElement('div'); div.className = 'snowflake'; div.style.left = Math.random()*100 + 'vw'; div.style.animationDuration = (Math.random()*10 + 5) + 's'; div.style.animationDelay = Math.random()*10 + 's'; layer.appendChild(div); } }
    </script>
</body>
</html>
