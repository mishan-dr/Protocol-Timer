<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° ASCENSION PROTOCOL - EXECUTION MODE</title>
    
    <meta name="theme-color" content="#007bff">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png"> 
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        :root {
            --bg-color: #f7f9fc; 
            --card-bg: #ffffff;
            --primary: #007bff; /* Focus Blue */
            --accent: #ff7043; /* Action Orange */
            --water: #00bcd4; /* Hydration Cyan */
            --text: #333333;
            --dim: #6c757d;
            --border: #f0f0f0;
            --font-main: 'Roboto', sans-serif;
        }

        /* --- DARK MODE VARIABLES --- */
        body.dark-mode {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --primary: #4da3ff;
            --accent: #ff8a65;
            --water: #26c6da;
            --text: #e0e0e0;
            --dim: #a0a0a0;
            --border: #333333;
        }

        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;700;900&display=swap');

        * { box-sizing: border-box; margin: 0; padding: 0; transition: background-color 0.3s, color 0.3s; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text);
            font-family: var(--font-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- Dark Mode Toggle --- */
        .theme-toggle {
            position: fixed; top: 20px; right: 20px;
            background: var(--card-bg); border: 1px solid var(--border);
            color: var(--text); padding: 10px 15px; border-radius: 50px;
            cursor: pointer; z-index: 1100; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            font-weight: bold; display: flex; align-items: center; gap: 5px;
        }
        .theme-toggle:hover { transform: scale(1.05); }

        /* --- Overlay --- */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); display: flex; justify-content: center; align-items: center;
            flex-direction: column; z-index: 1000; cursor: pointer;
        }
        #overlay h1 { font-size: 2.5rem; color: var(--primary); margin-bottom: 30px; }
        #overlay button {
            padding: 15px 40px; font-size: 1.2rem; font-weight: 700;
            color: white; background-color: var(--accent); border: none;
            border-radius: 50px; cursor: pointer; transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);
        }

        /* --- Layout --- */
        .container {
            display: flex; max-width: 1200px; margin: 20px auto; width: 95%; gap: 20px;
        }
        .left-panel { flex: 3; display: flex; flex-direction: column; gap: 20px; }
        .right-panel { flex: 2; display: flex; flex-direction: column; gap: 20px; }

        /* --- Dashboard Head --- */
        .dashboard-head {
            background-color: var(--card-bg); padding: 30px;
            border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            text-align: center; position: relative;
        }
        .protocol-title { font-size: 1.4rem; font-weight: 900; color: var(--primary); letter-spacing: 1px; margin-bottom: 5px; }
        .current-task-main { font-size: 2.5rem; font-weight: 900; color: var(--text); margin: 10px 0; text-transform: uppercase; }
        .countdown { font-size: 6rem; font-weight: 100; color: var(--accent); line-height: 1; }
        
        .sub-task-timer { margin-top: 15px; padding: 10px; background-color: var(--bg-color); border-radius: 8px; font-size: 1.2rem; font-weight: 700; color: var(--primary); }

        /* --- Mini Water HUD --- */
        .mini-water-hud {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 188, 212, 0.1);
            border: 1px solid var(--water);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            align-items: center;
        }
        .hud-row { display: flex; justify-content: space-between; width: 100%; max-width: 400px; font-size: 0.95rem; font-weight: 600; color: var(--text); }
        .water-val { color: var(--water); font-weight: 900; font-size: 1.1rem; }
        .progress-bar-bg { width: 100%; height: 8px; background-color: rgba(0,0,0,0.1); border-radius: 4px; margin-top: 5px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background-color: var(--water); width: 0%; transition: width 0.5s ease; }
        .next-sip-alert { font-size: 0.85rem; color: var(--dim); margin-top: 5px; font-style: italic; }

        /* --- Widgets --- */
        .widgets-row { display: flex; gap: 20px; }
        .widget-box { background-color: var(--card-bg); padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); flex: 1; }
        .widget-box h3 { color: var(--primary); font-size: 1rem; margin-bottom: 10px; text-transform: uppercase; border-bottom: 1px solid var(--border); padding-bottom: 5px;}

        /* Water List */
        .water-list { list-style: none; font-size: 0.85rem; max-height: 200px; overflow-y: auto; }
        .water-item { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid var(--border); color: var(--text); }
        .water-item.done { text-decoration: line-through; opacity: 0.5; }

        /* --- NEW CALENDAR STYLES --- */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; font-size: 0.85rem; }
        .cal-day-header { font-weight: bold; color: var(--dim); font-size: 0.7rem; }
        .cal-day { padding: 5px; border-radius: 4px; color: var(--text); }
        .cal-day.today { background-color: var(--accent); color: white; font-weight: bold; }
        
        /* New Header for Arrows */
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; color: var(--primary); font-weight: bold; font-size: 0.9rem; }
        .cal-btn { background: none; border: none; cursor: pointer; color: var(--accent); font-weight: bold; font-size: 1.2rem; padding: 0 10px; transition: transform 0.2s; }
        .cal-btn:hover { transform: scale(1.2); color: var(--primary); }

        /* Counters */
        .counter-widget { background: linear-gradient(135deg, rgba(0, 123, 255, 0.1), rgba(0, 123, 255, 0.2)); padding: 20px; border-radius: 12px; text-align: center; border: 1px solid var(--primary); }
        .counter-grid { display: flex; justify-content: space-around; }
        .counter-value { font-size: 2rem; font-weight: 900; color: var(--accent); }
        .counter-label { font-size: 0.7rem; color: var(--dim); text-transform: uppercase; }
        
        /* Music & Schedule */
        .music-player { background-color: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); }
        .schedule-box { background-color: var(--card-bg); padding: 20px 0 0 0; border-radius: 12px; flex: 1; min-height: 300px; display: flex; flex-direction: column; }
        .schedule-list { padding: 0 20px; overflow-y: auto; flex: 1; max-height: 60vh; }
        .schedule-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border); color: var(--dim); }
        .schedule-item.active { background-color: rgba(0, 123, 255, 0.05); color: var(--primary); font-weight: 700; border-radius: 4px; padding: 12px 5px; margin: 0 -5px; }
        .time-col { font-weight: 600; min-width: 90px; font-size: 0.9rem;}
        .task-col { flex: 1; text-align: left; text-transform: uppercase; margin-left: 10px; font-size: 0.9rem;}
        .footer { padding: 15px; text-align: center; font-size: 0.9rem; color: var(--dim); margin-top: 20px; }

        @media (max-width: 900px) {
            .container { flex-direction: column; }
            .widgets-row { flex-direction: column; }
            .countdown { font-size: 4rem; }
        }
    </style>
</head>
<body>

    <audio id="alarmSound" preload="auto"></audio>
    <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">üåô Dark Mode</button>

    <div id="overlay">
        <h1>ü¶Å ASCENSION PROTOCOL</h1>
        <button onclick="startProtocol()">INITIATE PROTOCOL</button>
        <p style="margin-top:20px; color:#999; font-size:0.9rem;">v2.2 // Calendar Navigation Enabled</p>
    </div>

    <div class="container">
        <div class="left-panel">
            <div class="dashboard-head">
                <div class="protocol-title">EXECUTION MODE</div>
                <div class="countdown" id="timer">00:00:00</div>
                <div class="current-task-main" id="taskName">LOADING...</div>
                
                <div class="sub-task-timer" id="subTaskTimer">
                    <span>Task Detail:</span> <span id="subTaskName">Awaiting Cycle Start</span>
                </div>

                <div class="mini-water-hud">
                    <div class="hud-row">
                        <span>üíß Intake So Far:</span>
                        <span class="water-val" id="hudConsumed">0 ml</span>
                    </div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="hudBar"></div>
                    </div>
                    <div class="hud-row" style="margin-top:5px; font-size:0.8rem; color:var(--dim);">
                        <span>Target: 3500ml</span>
                        <span id="hudPercent">0%</span>
                    </div>
                    <div class="next-sip-alert" id="hudNext">Next: Loading...</div>
                </div>
            </div>

            <div class="counter-widget">
                <div class="counter-grid">
                    <div class="counter-item">
                        <div class="counter-value" id="daysCount">000</div>
                        <div class="counter-label">Days Left</div>
                    </div>
                    <div class="counter-item">
                        <div class="counter-value" id="hoursCount">00</div>
                        <div class="counter-label">Hours</div>
                    </div>
                </div>
                <div style="margin-top:10px; font-weight:bold; color:var(--primary);">NEET TARGET LOCK</div>
            </div>

            <div class="widgets-row">
                <div class="widget-box">
                    <h3>üö∞ Hydration Schedule</h3>
                    <ul class="water-list" id="fullWaterList">
                    </ul>
                </div>

                <div class="widget-box">
                    <h3>üìÖ Protocol Log</h3>
                    <div id="miniCalendar"></div>
                </div>
            </div>
            
            <div class="motivation-box" style="background:var(--card-bg); padding:15px; border-radius:12px; border-left:4px solid var(--accent);">
                <blockquote id="motivationQuote" style="font-style:italic; color:var(--text);">"Loading quote..."</blockquote>
            </div>

        </div>

        <div class="right-panel">
            <div class="music-player">
                <h3>üéß Audio Focus</h3>
                <label for="fileInput" class="file-label" style="display:block; background:var(--primary); color:white; text-align:center; padding:10px; border-radius:6px; margin-bottom:10px; cursor:pointer;">Load Tracks</label>
                <input type="file" id="fileInput" multiple accept="audio/*" style="display:none;">
                <audio id="musicPlayer" controls loop style="width:100%;"></audio>
                <div id="trackName" style="text-align:center; font-size:0.8rem; margin-top:5px; color:var(--dim);">No track loaded.</div>
            </div>

            <div class="schedule-box">
                <h3 style="margin:0 20px 10px; border-bottom:1px solid var(--border); padding-bottom:10px; color:var(--text);">Timetable</h3>
                <div class="schedule-list" id="scheduleList">
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        "Your batchmates will study. You will dominate."
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        const schedule = [
            { start: "08:00", end: "08:30", task: "üåÖ WAKE UP (Hydrate & Prep)", type: "prep", breakdown: [] },
            { start: "08:30", end: "10:00", task: "‚öîÔ∏è CYCLE 1", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "10:00", end: "10:15", task: "‚òï BREAK (Water/Stretch)", type: "break", breakdown: [] },
            { start: "10:15", end: "11:45", task: "‚öîÔ∏è CYCLE 2", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "11:45", end: "12:00", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "12:00", end: "12:45", task: "üçΩÔ∏è LUNCH + RESET", type: "break", breakdown: [] },
            { start: "12:45", end: "14:15", task: "‚öîÔ∏è CYCLE 3", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "14:15", end: "14:30", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "14:30", end: "16:00", task: "‚öîÔ∏è CYCLE 4", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "16:00", end: "16:15", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "16:15", end: "17:45", task: "‚öîÔ∏è CYCLE 5", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "17:45", end: "18:30", task: "üí™ BODY RESET (Workout)", type: "prep", breakdown: [] },
            { start: "18:30", end: "19:00", task: "üçΩÔ∏è DINNER (No Screen Zone)", type: "break", breakdown: [] },
            { start: "19:00", end: "20:30", task: "‚öîÔ∏è CYCLE 6", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "20:30", end: "20:45", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "20:45", end: "22:15", task: "‚öîÔ∏è CYCLE 7", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] },
            { start: "22:15", end: "22:30", task: "‚òï BREAK", type: "break", breakdown: [] },
            { start: "22:30", end: "23:59", task: "üß® CYCLE 8 (THE KILLER)", type: "work", breakdown: ["25 min Revision", "20 min Timed Questions", "45 min Lecture"] }, 
            { start: "00:00", end: "00:20", task: "üìñ WIND DOWN", type: "prep", breakdown: [] },
            { start: "00:20", end: "08:00", task: "üò¥ SLEEP & RECOVER", type: "sleep", breakdown: [] }
        ];

        const waterPlan = [
            { time: "08:00", ml: 400, note: "Wake Up (Flush)" },
            { time: "08:30", ml: 200, note: "Pre-Cycle 1" },
            { time: "10:00", ml: 250, note: "Post-Cycle 1" },
            { time: "11:45", ml: 350, note: "Post-Cycle 2" },
            { time: "12:00", ml: 400, note: "Lunch (Digestion)" },
            { time: "14:15", ml: 250, note: "Post-Cycle 3" },
            { time: "16:00", ml: 350, note: "Post-Cycle 4" },
            { time: "17:45", ml: 300, note: "Pre-Workout" },
            { time: "18:30", ml: 300, note: "Workout Sip" },
            { time: "19:00", ml: 300, note: "Dinner" },
            { time: "20:30", ml: 200, note: "Post-Cycle 6" },
            { time: "22:15", ml: 250, note: "Post-Cycle 7" },
            { time: "00:00", ml: 150, note: "Post-Cycle 8" }
        ];
        
        const NEET_TARGET_DATE = new Date('May 4, 2026 14:00:00'); 
        const quotes = ["Distraction is death.", "Identity is focus.", "While they sleep, you grind.", "Physics is logic. Biology is reflex.", "Don't negotiate with yourself."];

        // --- 2. GLOBAL VARIABLES ---
        let protocolStarted = false;
        let lastSeconds = -1;
        let lastCycleIndex = -1;
        let lastSubTaskIndex = -1;
        
        // Calendar view state
        let calendarViewDate = new Date(); 

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const musicPlayer = document.getElementById('musicPlayer');
        const fileInput = document.getElementById('fileInput');
        const trackNameEl = document.getElementById('trackName');
        const scheduleListEl = document.getElementById('scheduleList');
        let playlist = [];
        let currentTrackIndex = 0;

        // --- 3. THEME LOGIC ---
        function toggleTheme() {
            const body = document.body;
            body.classList.toggle('dark-mode');
            const btn = document.getElementById('themeBtn');
            const isDark = body.classList.contains('dark-mode');
            btn.innerHTML = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }
        window.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeBtn').innerHTML = '‚òÄÔ∏è Light Mode';
            }
            renderCalendar();
            renderWaterList();
        });

        // --- 4. WATER HUD LOGIC ---
        function updateWaterHUD() {
            const now = new Date();
            let consumed = 0;
            let nextSip = null;
            const waterListEl = document.getElementById('fullWaterList');
            const items = waterListEl.getElementsByTagName('li');

            waterPlan.forEach((entry, index) => {
                const entryTime = getTodayDate(entry.time);
                if (entry.time === "00:00" && now.getHours() > 12) {
                     entryTime.setDate(entryTime.getDate() + 1);
                }
                if (now >= entryTime) {
                    consumed += entry.ml;
                    if(items[index]) items[index].classList.add('done');
                } else {
                    if (!nextSip) nextSip = entry;
                }
            });

            document.getElementById('hudConsumed').innerText = consumed + " ml";
            const percent = Math.min(100, Math.floor((consumed / 3700) * 100));
            document.getElementById('hudPercent').innerText = percent + "%";
            document.getElementById('hudBar').style.width = percent + "%";
            
            if (nextSip) {
                document.getElementById('hudNext').innerText = `Next: ${nextSip.ml}ml @ ${nextSip.time} (${nextSip.note})`;
            } else {
                document.getElementById('hudNext').innerText = "Hydration Goal Complete.";
            }
        }

        function renderWaterList() {
            const list = document.getElementById('fullWaterList');
            let html = '';
            waterPlan.forEach(p => {
                html += `<li class="water-item"><span>${p.time} ${p.note}</span> <span>${p.ml}ml</span></li>`;
            });
            list.innerHTML = html;
        }

        // --- 5. CALENDAR LOGIC (UPDATED WITH NAVIGATION) ---
        function renderCalendar() {
            const calContainer = document.getElementById('miniCalendar');
            
            const viewYear = calendarViewDate.getFullYear();
            const viewMonth = calendarViewDate.getMonth();
            
            // Real date for highlighting 'today'
            const realNow = new Date();
            const realDay = realNow.getDate();
            const realMonth = realNow.getMonth();
            const realYear = realNow.getFullYear();

            const firstDay = new Date(viewYear, viewMonth, 1).getDay();
            const daysInMonth = new Date(viewYear, viewMonth + 1, 0).getDate();
            
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

            let html = `
                <div class="cal-header">
                    <button class="cal-btn" onclick="changeMonth(-1)">&#10094;</button>
                    <span>${monthNames[viewMonth]} ${viewYear}</span>
                    <button class="cal-btn" onclick="changeMonth(1)">&#10095;</button>
                </div>
                <div class="calendar-grid">
            `;
            
            ['S','M','T','W','T','F','S'].forEach(d => html += `<div class="cal-day-header">${d}</div>`);
            
            // Empty slots
            for(let i=0; i<firstDay; i++) html += `<div></div>`;
            
            // Days
            for(let i=1; i<=daysInMonth; i++) {
                let classes = "cal-day";
                // Only highlight if view matches real date
                if (i === realDay && viewMonth === realMonth && viewYear === realYear) {
                    classes += " today";
                }
                html += `<div class="${classes}">${i}</div>`;
            }
            html += `</div>`;
            calContainer.innerHTML = html;
        }

        function changeMonth(offset) {
            // Update view date by offset
            calendarViewDate.setMonth(calendarViewDate.getMonth() + offset);
            renderCalendar();
        }

        // --- 6. SCHEDULE & TIMER ---
        function getTodayDate(timeStr) {
            const now = new Date();
            const [hours, minutes] = timeStr.split(':').map(Number);
            return new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, 0);
        }

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = totalSeconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function reorderScheduleList(currentTaskIndex) {
            scheduleListEl.innerHTML = '';
            const listFragment = document.createDocumentFragment();
            const completedItems = [];
            
            const createItem = (item, idx, status) => {
                const div = document.createElement('div');
                div.className = `schedule-item ${status}`;
                div.innerHTML = `<div class="time-col">${item.start}-${item.end}</div><div class="task-col">${item.task}</div>`;
                return div;
            };

            for (let i = currentTaskIndex; i < schedule.length; i++) {
                listFragment.appendChild(createItem(schedule[i], i, i === currentTaskIndex ? 'active' : ''));
            }
            for (let i = 0; i < currentTaskIndex; i++) {
                completedItems.push(createItem(schedule[i], i, 'completed'));
            }
            completedItems.forEach(item => listFragment.appendChild(item));
            scheduleListEl.appendChild(listFragment);
        }

        function updateSubTask(now, currentItem, currentItemStart) {
            const subTaskEl = document.getElementById('subTaskName');
            if (!currentItem.breakdown.length) {
                subTaskEl.innerText = currentItem.type === 'work' ? "Deep Work Phase" : "Recovery Phase";
                return;
            }
            let acc = 0;
            let found = false;
            for (let i = 0; i < currentItem.breakdown.length; i++) {
                const part = currentItem.breakdown[i];
                const dur = parseInt(part.split(' ')[0]) * 60000;
                const start = new Date(currentItemStart.getTime() + acc);
                const end = new Date(start.getTime() + dur);
                if (now >= start && now < end) {
                    subTaskEl.innerText = `${part} (Ends: ${formatTime(end - now)})`;
                    if (Math.floor((end - now)/1000) === 0 && i !== lastSubTaskIndex) playAlarm();
                    lastSubTaskIndex = i;
                    found = true;
                    break;
                }
                acc += dur;
            }
            if(!found) subTaskEl.innerText = "Transitioning...";
        }

        function updateTimer() {
            const now = new Date();
            let currentTaskIndex = -1;
            
            for (let i = 0; i < schedule.length; i++) {
                let start = getTodayDate(schedule[i].start);
                let end = getTodayDate(schedule[i].end);
                if (end < start) {
                    if (now >= start) end.setDate(end.getDate() + 1);
                    else if (now < end) start.setDate(start.getDate() - 1);
                }

                if (now >= start && now < end) {
                    currentTaskIndex = i;
                    const diff = end - now;
                    document.getElementById('taskName').innerText = schedule[i].task;
                    document.getElementById('timer').innerText = formatTime(diff);
                    updateSubTask(now, schedule[i], start);

                    if (currentTaskIndex !== lastCycleIndex) {
                        playAlarm();
                        if (schedule[i].type === 'work') document.getElementById('motivationQuote').innerText = quotes[Math.floor(Math.random()*quotes.length)];
                        reorderScheduleList(currentTaskIndex);
                    }
                    lastCycleIndex = currentTaskIndex;
                    if(Math.floor(diff/1000) === 0 && Math.floor(diff/1000) !== lastSeconds) playAlarm();
                    lastSeconds = Math.floor(diff/1000);
                    
                    const timerEl = document.getElementById('timer');
                    timerEl.style.color = (diff < 600000 && diff > 0) ? 'var(--accent)' : 'var(--primary)'; 
                    break;
                }
            }
            if (currentTaskIndex === -1 && lastCycleIndex !== -1) reorderScheduleList(schedule.length);
        }

        // --- 7. UTILS ---
        function playAlarm() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.5);
        }

        function updateNeetCounter() {
            const diff = NEET_TARGET_DATE - new Date();
            if(diff<0) return;
            document.getElementById('daysCount').innerText = String(Math.floor(diff / (1000*60*60*24))).padStart(3,'0');
            document.getElementById('hoursCount').innerText = String(Math.floor((diff % (1000*60*60*24))/(1000*60*60))).padStart(2,'0');
        }

        // Music
        fileInput.addEventListener('change', (e) => {
            playlist = Array.from(e.target.files);
            currentTrackIndex = 0;
            if(playlist.length) {
                const url = URL.createObjectURL(playlist[0]);
                musicPlayer.src = url;
                trackNameEl.innerText = `Playing: ${playlist[0].name}`;
                musicPlayer.play();
            }
        });
        musicPlayer.addEventListener('ended', () => {
            currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
            musicPlayer.src = URL.createObjectURL(playlist[currentTrackIndex]);
            trackNameEl.innerText = `Playing: ${playlist[currentTrackIndex].name}`;
            musicPlayer.play();
        });

        // Start
        function startProtocol() {
            document.getElementById('overlay').style.display = 'none';
            if (audioCtx.state === 'suspended') audioCtx.resume();
            updateNeetCounter();
            updateTimer();
            updateWaterHUD(); 
            setInterval(updateTimer, 1000);
            setInterval(updateNeetCounter, 60000);
            setInterval(updateWaterHUD, 60000);
        }

        // Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(console.error);
        }
    </script>
</body>
</html>
